import requests
import json
import os
import sys

GITHUB_USER = "robelt59"  # Your GitHub username
GITHUB_TOKEN = "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"  # Your Personal Access Token

def create_github_repo(repo_name):
    url = 'https://api.github.com/user/repos'
    headers = {
        'Authorization': f'token {GITHUB_TOKEN}',
        'Accept': 'application/vnd.github.v3+json'
    }
    payload = {
        'name': repo_name,
        'private': True  # Set to True if you want to create a private repository
    }
    
    response = requests.post(url, headers=headers, json=payload)
    
    if response.status_code == 201:
        repo_data = response.json()
        ssh_url = repo_data.get('ssh_url')
        print(f"Repository '{repo_name}' created successfully.")
        print(f"SSH URL: {ssh_url}")
        return ssh_url
    else:
        error_message = response.json().get('message', 'Unknown error')
        print(f"Failed to create repository: {error_message}")
        raise Exception(f"Error creating repository: {error_message}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python create_github_repo.py <folder_path>")
        sys.exit(1)

    folder_path = sys.argv[1]
    
    if not os.path.exists(folder_path):
        print(f"Error: The folder '{folder_path}' does not exist.")
        sys.exit(1)
    
    # Use the folder name as the repository name
    repo_name = os.path.basename(os.path.normpath(folder_path))
    
    # Create the GitHub repository and get the SSH URL
    ssh_url = create_github_repo(repo_name)
    
    # Print the SSH URL
    print(f"The SSH URL for the repository is: {ssh_url}")
